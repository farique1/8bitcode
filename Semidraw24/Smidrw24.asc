1 ' Semidraw24 - Paint and animate in semigraphics on a CoCo
2 ' Copyright (C) 2020 - Fred Rique (farique)
3 ' https://github.com/farique1/8bitcode
4 ' Convert(ed) from CoCo Basic Dignified with
5 ' https://github.com/farique1/coco-basic-dignified
6 CLEAR 200:GOSUB 114
7 A$=INKEY$:POKE D,&H80:POKE D,C:IF A$="" THEN 7
8 POKE D,E:IF A$=R$ THEN M=X:GOSUB 28:GOTO 7
9 IF A$=L$ THEN M=-X:GOSUB 28:GOTO 7
10 IF A$=U$ THEN M=-Y:GOSUB 28:GOTO 7
11 IF A$=D$ THEN M=Y:GOSUB 28:GOTO 7
12 IF A$=T$ THEN CE=NOT CE:GOSUB 52
13 IF CE THEN GOSUB 44:GOTO 7
14 IF A$=" " THEN POKE D,C:E=PEEK(D)
15 IF A$="," THEN M=-1:GOSUB 38
16 IF A$="." THEN M=1:GOSUB 38
17 IF A$="<" THEN M=-16:GOSUB 38
18 IF A$=">" THEN M=16:GOSUB 38
19 IF A$>="0" AND A$<="9" THEN GOSUB 55
20 IF A$="X" THEN CH=NOT CH:GOSUB 49
21 IF A$="Z" THEN HD=NOT HD:GOSUB 51
22 IF A$="I" THEN MS$="LOAD":GOSUB 88
23 IF A$="O" THEN MS$="SAVE":GOSUB 88
24 IF A$="N" THEN C=PEEK(D):GOSUB 50
25 IF A$="Q" THEN SCREEN 1,1
26 A=INSTR(1,S$,A$):ON A GOSUB 71,59,59,36,53,54,37,63,97,79,86,86,86,87,64,65,66,57
27 GOTO 7
28 TIMER=0
29 IF CD OR PEEK(&H159)=&HF7 THEN E=C
30 IF PEEK(&H155)=&HDF THEN GOSUB 64
31 POKE D,E:D=D+M:IF D<&H400 THEN D=D+&H1800
32 IF D>&H1BFF THEN D=D-&H1800
33 E=PEEK(D):POKE D,C
34 IF PEEK(&H155)=&HF7 OR PEEK(&H156)=&HF7 OR PEEK(&H157)=&HF7 OR PEEK(&H158)=&HF7 THEN POKE &H155,&HFF:POKE &H156,&HFF:POKE &H157,&HFF:POKE &H158,&HFF:IF TIMER>30 THEN POKE D,&H80:GOTO 29 ELSE POKE D,&H80:GOTO 34
35 POKE &H87,0:RETURN
36 X=(&H1-X)+&H1:Y=(&H180-Y)+&H20:GOSUB 52:RETURN
37 POKE D,C:E=PEEK(D):CD=NOT CD:GOSUB 52:RETURN
38 TIMER=0
39 C=C+M:IF C<0 THEN C=255
40 IF C>255 THEN C=0
41 GOSUB 50
42 IF PEEK(&H156)=&HDF OR PEEK(&H158)=&HDF THEN POKE &H156,&HFF:POKE &H158,&HFF:IF TIMER>30 THEN POKE D,C:GOTO 39 ELSE GOTO 42
43 POKE &H87,0:RETURN
44 C=ASC(A$):IF C<&H20 THEN GOTO 7
45 IF C=&H5F THEN CI=NOT CI:GOSUB 52:GOTO 7
46 IF C>=&H20 AND C<=&H3F THEN C=C+&H40
47 IF CI THEN C=C-&H40
48 GOSUB 63:D=D+1:E=PEEK(D):RETURN
49 IF CH THEN GET(248,12)-(255,23),CH:GOSUB 50:RETURN ELSE PUT(248,12)-(255,23),CH:RETURN
50 IF CH THEN FOR F=&H59F TO &H6FF STEP &H20:POKE F,C:NEXT:RETURN ELSE RETURN
51 IF HD THEN GET(248,0)-(255,11),HD:FOR F=&H41F TO &H57F STEP &H20:POKE F,&H80:NEXT:GOSUB 52:RETURN ELSE PUT(248,0)-(255,11),HD:RETURN
52 IF NOT HD THEN RETURN ELSE POKE &H41F,&H80-((&H20-Y)/&H160)*&H4F:POKE &H45F,&H80-CD*&H1F:POKE &H49F,&H80-CE*&H3F:POKE &H4DF,&H80-CI*&H6F:RETURN
53 Z=-1:GOSUB 69:GET(M1,N1)-(M1+7,N1+11),CP:RETURN
54 Z=0:GOSUB 69:PUT(M1,N1)-(M1+7,N1+11),CP:E=PEEK(D):RETURN
55 IF A$<>B$ THEN PT=0:B$=A$ ELSE PT=PT+5:PT=-(PT<11)*PT
56 C=(ASC(A$)-&H30)*&H10+&H7F-PT:C=C+(ASC(A$)=&H39)*(C-&H60):C=C+(ASC(A$)=&H30)*(C-&H20):GOSUB 50:RETURN
57 IF C<&H80 THEN RETURN ELSE Z=0:GOSUB 69:FOR F=MN TO MN+&H17F STEP &H20:IF PEEK(F)>&H80 THEN POKE F,PEEK(F)+(INT(C/16-7)-INT(PEEK(F)/16-7))*16
58 NEXT:E=PEEK(D):RETURN
59 GOSUB 90:?@&HC7,YS$:EXEC&HADFB:GOSUB 91:IF PEEK(&H87)=&H59 THEN IF A$=CS$ THEN GOSUB 61 ELSE GOSUB 62
60 GOSUB 49:GOSUB 51:POKE&H87,0:RETURN
61 E=C:BT=((255-C)*3+3-(256*(2-INT(C/85.5))))*INT((C/255)+0.99609):POKE &HB3,BT:PCLS:GET(248,12)-(255,23),CH:RETURN
62 FOR F=0 TO 248 STEP 8:PUT(F,0)-(F+7,11),CP:NEXT:GET(0,0)-(255,11),SB:FOR F=12 TO 180 STEP 24:PUT(0,F)-(255,F+11),SB:PUT(0,180-F)-(255,180-F+11),SB:NEXT:E=PEEK(D):GET(248,12)-(255,23),CH:RETURN
63 E=C:Z=0:GOSUB 69:FOR F=MN TO MN+&H17F STEP &H20:POKE F,C:NEXT:RETURN
64 N=E:GOSUB 67:E=N:POKE D,E:RETURN
65 Z=0:GOSUB 69:FOR F=MN TO MN+&H17F STEP &H20:M=PEEK(F):N=M:GOSUB 67:M=N:POKE F,M:NEXT:GOSUB 64:RETURN
66 N=C:GOSUB 67:C=N:GOSUB 50:RETURN
67 IF N<&H40 THEN N=N+&H40 ELSE N=N-&H40:IF N>&H3F AND N<&H80 THEN N=N+&H80
68 RETURN
69 N=((D-&H400)/&H20):M=(N-INT(N))/0.03125:N=INT(N/12):M1=M*8:N1=N*12:MN=&H400+M+N*&H180:IF Z THEN GET(M1,N1)-(M1+7,N1+11),AC:POKE &HB2,&H3:LINE(M1,N1)-(M1+7,N1+11),PSET,BF:POKE &HB2,&H23:LINE(M1,N1)-(M1+7,N1+11),PSET,BF:PUT(M1,N1)-(M1+7,N1+11),AC
70 RETURN
71 GOSUB 90:IF NOT AT THEN FOR F=0 TO 255:POKE &H400+F,F:NEXT:GET(0,0)-(255,7),AT:AT=-1:?@&H121,"BUFFERED. NO RENDER NEXT TIME!"ELSE PUT(0,0)-(255,7),AT
72 ?@&H162,"arrows CHOOSE NEW CHACACTER"TAB(&H42)"enter GET CHARACTER AND EXIT"TAB(&H42)"any key EXIT WITHOUT GETTING";
73 N=PEEK(TC)
74 A$=INKEY$:POKE TC,&HFF:POKE TC,&H9F:POKE TC,N:IF A$="" THEN 74
75 TC=TC-(A$=R$)*&H1:TC=TC+(A$=L$)*&H1:TC=TC+(A$=U$)*&H20:TC=TC-(A$=D$)*&H20:IF TC>&H4FF THEN TC=TC-&H100 ELSE IF TC<&H400 THEN TC=TC+&H100
76 N=PEEK(TC):IF A$=E$ THEN C=N:GOTO 78 ELSE IF A$<>R$ AND A$<>L$ AND A$<>U$ AND A$<>D$ THEN 78
77 GOTO 74
78 GOSUB 91:RETURN
79 AL=((EX-BX)+(((EY-BY)/12)*256))/8:M=0:N=0
80 FOR F=0 TO AL:GET(BX+M,BY+N)-(BX+M+7,BY+N+11),AC:PUT(AX,AY)-(AX+7,AY+11),AC:M=M+8:IF BX+M>255 THEN M=-BX:N=N+12
81 A$=INKEY$:IF A$="A" THEN RETURN
82 IF A$>"/" AND A$<":" THEN FR=(ASC(A$)-&H30)*20
83 FOR I=0 TO FR:NEXT:NEXT:M=0:N=0
84 GOTO 80
85 RETURN
86 Z=-1:GOSUB 69:IF A$="S" THEN AB=&H400+M+N*&H180:BX=M1:BY=N1:RETURN ELSE IF A$="D" THEN AE=&H400+M+N*&H180:EX=M1:EY=N1:RETURN ELSE AC=&H400+M+N*&H180:AX=M1:AY=N1:RETURN
87 F=D:D=AB:Z=-1:GOSUB 69:D=AE:Z=-1:GOSUB 69:D=AC:Z=-1:GOSUB 69:D=F:RETURN
88 GOSUB 90:?@&H85,"INSERT CASSETE TO "+MS$TAB(&H4A)"any key EXIT"TAB(&H4B)"enter "+MS$:EXEC&HADFB:IF PEEK(&H87)=&HD THEN POKE &HFFD6,0:IF A$="O" THEN PUT(0,0)-(255,15),SB:CSAVEM "SAART",&H400,&H1BFF,0:GOSUB 91 ELSE GOSUB 91:CLOADM
89 POKE &HFFD7+HS,0:GOSUB 91:POKE&H87,0:RETURN
90 HT=HD:HD=0:GOSUB 51:CT=CH:CH=0:GOSUB 49:GET(0,0)-(255,15),SB:CLS:SCREEN 0,1:RETURN
91 SCREEN 0,0:A=PEEK (&HFF22):POKE &HFF22,(A AND &H7):POKE &HFFC5,1:POKE &HFFC3,1:POKE &HFFC0,0:IF A$<>"I" THEN PUT(0,0)-(255,15),SB
92 HD=HT:GOSUB 51:CH=CT:GOSUB 49:RETURN
93 GOSUB 90:M=0:FOR F=0 TO 9:POKE&H42B+F,&H2D:POKE&H474-F,&H2D:POKE&H42A+(INT(M)*&H20),&H20:POKE&H475-(INT(M)*&H20),&H20:M=M+0.3:NEXT
94 ?@&H4B,"semidraw";:POKE&H453,&H32:POKE&H454,&H34:?@&HCA,"? - FOR HELP"TAB(&H29)"(AFTER  START)"TAB(&H48)"any key TO START"TAB(&H42)"n TO DISABLE HIGH SPEED POKE"TAB(&H67)"FRED RIQUE (C)2020"TAB(&H22)"GITHUB.COM/FARIQUE1/8BITCODE";
95 POKE &H4CA,PEEK(&H4CA)-&H40
96 EXEC&HADFB:GOSUB 91:RETURN
97 GOSUB 90
98 PG=1:CLS:?@0,"KEYS HELP  semidraw24      PG","^=SHIFT":POKE&H413,&H32:POKE&H414,&H34:?@29,STR$(PG);
99 ?@&H60,"ARROWS MOVEMENT. HOLD KEEP MOV.",,,"/ TOGGLE 12X VERTICAL MOVEMENT",,,"SPACE DRAW. HOLD KEEP DRAWING",,,"M TOGGLE CONTINUOUS DRAW",,,", . PREVIOUS / NEXT CHARACTER",,,", . + ^ JUMP 16 CHARACTERS",,," any key NEXT PAGE   enter BACK";
100 MQ=5:MP=0:ML=&H460:GOSUB 113:IF PEEK(&H87)=&HD THEN 112
101 PG=PG+1:?@29,STR$(PG);:?@&H60,"1-8 COLOR. AGAIN CYCLE PATTERNS",,,"9 0 NORMAL / INVERTED CHARACTERS",,"C V COPY / PASTE CHARACTER BLOCK",,"B STAMP CURRENT CHARACTER",,,"N GET CHARACTER UNDER CURSOR",,,"; : L INV LOC / BLOCK / CHAR"
102 MQ=5:MP=6:ML=&H460:GOSUB 113:IF PEEK(&H87)=&HD THEN 112
103 PG=PG+1:?@29,STR$(PG);:?@&H60,"LEFT + ^ TOGGLE TEXT MODE",,,"UP + ^ TOGGLE INVERTED TEXT",,,"CLEAR CLEAR SCREEN W/ CURR CHAR",,,"CLEAR + ^ CLEAR WITH COPY BUFFER",,"ENTER PICK CHARACTER FROM CHART",,,"I O LOAD / SAVE CASSETE ONLY"
104 MQ=5:MP=12:ML=&H460:GOSUB 113:IF PEEK(&H87)=&HD THEN 112
105 PG=PG+1:?@29,STR$(PG);:?@&H60,"K RECOLOR BLOCK WITH CHAR COLOR",,," ",,,," ",,,," ",,,," ",,,," "
106 MQ=0:MP=18:ML=&H460:GOSUB 113:IF PEEK(&H87)=&HD THEN 112
107 PG=PG+1:?@29,STR$(PG);:?@0,"HUD HELP ";:?@&H60,"Z TOGGLE INFORMATION HUD",,,"X TOGGLE SHOW CURRENT CHARACTER",,,"WHITE IND HIGH SPEED ENABLED",,,"YELLOW IND CONTINUOUS DRAW ENBLD",,"RED IND TEXT MODE ENABLED",,,"MAGENTA IND INV CHARACTER ENBLD"
108 MQ=5:MP=19:ML=&H460:GOSUB 113:IF PEEK(&H87)=&HD THEN 112
109 PG=PG+1:?@29,STR$(PG);:?@0,"ANIM HELP";:?@&H60,"A ANIMATE / EXIT ANIMATION",,,"S SET START FRAME",,,"D SET END FRAME",,,,"F SET ANIMATION BLOCK",,,"G SHOW ANIMATION SETUP",,,"0-9 ANIMATION SPEED - WHILE ANIM";
110 MQ=5:MP=25:ML=&H460:GOSUB 113:IF PEEK(&H87)=&HD THEN 112
111 GOTO 98
112 POKE&H87,0:GOSUB 91:RETURN
113 FOR F=0 TO MQ:FOR I=0 TO HP(F+MP)-1:M=ML+I+(F*&H40):POKE M,PEEK(M)-&H40:NEXT:NEXT:EXEC&HADFB:RETURN
114 IF PEEK(&HBC)=&HE THEN CLS:?@&H2C,"semianim"TAB(&H85)"THIS PROGRAM CURRENTLY"TAB(&H43)"DOESN'T SUPPORT DISK BASIC",,,,,,,"SORRY FOR THAT":END
115 PMODE 4,1:POKE &HBA,&H4:POKE&H167,&H39:R$=CHR$(9):L$=CHR$(8):U$=CHR$(94):D$=CHR$(10):E$=CHR$(13):T$=CHR$(21):CS$=CHR$(12):CC$=CHR$(92):S$=E$+CS$+CC$+"/CVMB?ASDFG;:LK":YS$="ARE YOU SURE? y n":B$=""
116 X=&H1:Y=&H20:C=&H41:D=&H400:E=&H60:PT=&H0:TC=&H400:AB=&H400:AE=&H400:AC=&H400:FR=0:CE=0:CI=0:CD=0:CH=-1:HD=-1:AT=0:DIM CH(8),HD(8),CP(8),SB(512),HP(31),AT(256),AC(8)
117 FOR F=0 TO 30:READ A:HP(F)=A:NEXT:GOSUB 93:HS=(PEEK(&H87)=&H4E):POKE &HFFD7+HS,0:POKE&H87,0:POKE &HB3,&HE0:PCLS:GET(248,12)-(255,23),CH:GOSUB 51:RETURN
118 DATA 6,1,5,1,3,7,3,3,3,1,1,5,8,6,5,9,5,3,1,1,1,9,10,7,11,1,1,1,1,1,3
