10 'Converted with MSX Basic Dignified
20 'https://github.com/farique1/msx-basic-dignified
30 ' MASCIISDRAWX
40 ' (C) Fred Rique (farique) 2020
50 ' github/farique1/8bitcode
60 CLEAR100,&HAFFF:DEFINTA-Z:' ml addresses, always check
70 DEFUSR1=&HB00D:DEFUSR2=&HB00A:V=&H1803:L=0:P=0:U$=CHR$(&H1E):R$=CHR$(&H1C):D$=CHR$(&H1F):L$=CHR$(&H1D):E$=CHR$(&H0D):S$=CHR$(&H20):Z$=CHR$(&H1B):K$="D":X$="E":LO$=CHR$(&H80)+CHR$(&H81)+CHR$(&H82)+CHR$(&H83)+CHR$(&H84)+CHR$(&H85)+CHR$(&H86)+CHR$(&H87)
80 CF$="":FX$=".scr"' leave blank to list all files
90 FA$=""' insert a file name to auto load
100 IFFX$=""THENFX$=".*"
110 SCREEN1:WIDTH32:KEYOFF:COLOR15,14,14:POKE&HFCAB,&HFF
120 BLOAD"masciisd.scr",S
130 A$=INKEY$:IFA$=""THEN130
140 IFFA$<>""THENBLOADFA$,S:R=-1:GOSUB210:GOSUB300:GOTO160
150 BLOAD"masciisd.bin",R:GOSUB300
160 BC=PEEK(&HB007)
170 IFBC=&H01THENGOSUB260:R=0:GOSUB210
180 IFBC=&H00THENGOSUB280:R=-1:GOSUB210
190 IFBC=&HFFTHENEND
200 GOTO160
210 ' r=reload MASCIISDRAWX
220 ' (BSAVE,S is ERASING the program from memory)
230 ' will restore the default colors
240 IFRANDFA$<>""THENPOKE&HB008,FG:BLOAD"masciisd.bin"
250 A=USR1(0):GOSUB300:RETURN
260 RQ$="load":GOSUB310:WIDTH32:IFFA$<>""THENCF$=FA$:BLOADFA$,S
270 RETURN
280 RQ$="save":GOSUB310:WIDTH32:A=USR2(0):IFFA$<>""THENCF$=FA$:BSAVEFA$,&H0,&H2020,S
290 RETURN
300 FG=PEEK(&HB008):FG=FGAND&B01111111:POKE&HB008,FG:RETURN
310 CLS:WIDTH26:LOCATE0,2:FILES"*"+FX$:FORF=2TO24:P=V+13+32*F:IFCHR$(VPEEK(P))=" "THENL=F+2:F=24
320 NEXT
330 IFCHR$(VPEEK(V+0+32*(L-2)))<>" "THEN?ELSEL=L-1
340 ?:?RQ$;":":?"WORK:";CF$:MF=VPEEK(V):LOCATE0,0:PRINTSTRING$(9," ");LO$;STRING$(8," ");:LOCATE0,1:PRINTSTRING$(25," ");:IFMF<>32THENLOCATE0,0:PRINT"^":LOCATE24,0:PRINT"^":L=21
350 X=12:Y=2:P=V+X+32*Y
360 LOCATEX,Y:PRINT"{"
370 A$=INKEY$:IFA$=""THEN370
380 LOCATEX,Y:PRINT" ":PX=X:PY=Y
390 IFA$=R$THENX=X+13:IFX>=31THENX=12
400 IFA$=L$THENX=X-13:IFX<=0THENX=25
410 IFA$=U$THENY=Y-1:IFY<=0THENY=0
420 IFA$=D$THENY=Y+1:IFY>=24THENY=24
430 IFA$=E$THENGOSUB510:RETURN
440 IFA$=S$THENGOSUB560:RETURN
450 IFA$=X$THENGOSUB580
460 IFA$=K$THENGOSUB600
470 IFA$=Z$THENPOKE&HB007,&H20:FA$="":RETURN
480 P=V+X+32*Y:IFVPEEK(P-12)=32THENX=PX:Y=PY:P=V+X+32*Y
490 GOTO360
500 RETURN
510 LOCATE5,L:FORF=P-12TOP-1:?CHR$(VPEEK(F));:NEXT
520 A$=INKEY$:IFA$=""THEN520
530 IFA$=S$THENGOSUB560:RETURN
540 IFA$<>E$THENLOCATE5,L:?STRING$(12," "):RETURN360
550 W=11:GOSUB650:RETURN
560 LOCATE5,L:LINEINPUTFA$:W=11:GOSUB650:IFFA$=STRING$(12," ")THENRETURN360
570 RETURN
580 LOCATE0,L:PRINT"ext :":LOCATE5,L:LINEINPUTFA$:W=4:GOSUB650:LOCATE0,L:PRINTRQ$;":";STRING$(12," "):IFFA$=STRING$(5," ")THENRETURNELSEFX$=FA$:IFLEFT$(FX$,1)<>"."THENFX$="."+FX$:RETURN310
590 RETURN
600 LOCATE0,L:PRINT"del :":LOCATE5,L:LINEINPUTFA$:W=11:GOSUB650:IFFA$=STRING$(12," ")THENLOCATE0,L:PRINTRQ$;":";STRING$(12," "):RETURN
610 LOCATE20,L:PRINT"sure?";
620 A$=INKEY$:IFA$=""THEN620
630 IFA$=E$ORA$="Y"THENKILLFA$:RETURN310
640 LOCATE0,L:PRINTRQ$;":";STRING$(20," "):RETURN
650 FA$="":P=V+5+32*L:FORF=PTOP+W:FA$=FA$+CHR$(VPEEK(F)):NEXT:RETURN
